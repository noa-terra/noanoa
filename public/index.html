<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Mini App - Products & Orders</title>
    <style>
      :root {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
      }
      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f5f5f7;
        padding: 1rem;
      }
      .card {
        background: white;
        padding: 1.5rem;
        border-radius: 0.75rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        width: 100%;
        max-width: 600px;
      }
      h1 {
        margin: 0 0 1rem;
        font-size: 1.3rem;
      }
      .tabs {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        border-bottom: 2px solid #f0f0f3;
      }
      .tab {
        padding: 0.5rem 1rem;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 0.9rem;
        color: #666;
        border-bottom: 2px solid transparent;
        margin-bottom: -2px;
      }
      .tab.active {
        color: #2563eb;
        border-bottom-color: #2563eb;
        font-weight: 500;
      }
      .tab:hover {
        color: #2563eb;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
      .form-row {
        display: flex;
        gap: 0.5rem;
      }
      input,
      select {
        flex: 1;
        padding: 0.4rem 0.6rem;
        border-radius: 0.4rem;
        border: 1px solid #d0d0d7;
        font-size: 0.9rem;
      }
      button {
        padding: 0.4rem 0.8rem;
        border-radius: 0.4rem;
        border: none;
        background: #2563eb;
        color: white;
        font-size: 0.9rem;
        cursor: pointer;
      }
      button:hover {
        background: #1d4ed8;
      }
      ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      li {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid #f0f0f3;
        font-size: 0.9rem;
      }
      li:last-child {
        border-bottom: none;
      }
      .empty {
        font-size: 0.85rem;
        color: #888;
        padding: 1rem 0;
        text-align: center;
      }
      .delete-btn {
        padding: 0.2rem 0.4rem;
        font-size: 0.75rem;
        border-radius: 999px;
        background: #fee2e2;
        color: #b91c1c;
        border: none;
        cursor: pointer;
      }
      .delete-btn:hover {
        background: #fecaca;
      }
      .product-info {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
        flex: 1;
      }
      .product-name {
        font-weight: 500;
      }
      .product-details {
        font-size: 0.8rem;
        color: #666;
      }
      .product-price {
        color: #2563eb;
        font-weight: 600;
      }
      .order-info {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
        flex: 1;
      }
      .order-customer {
        font-weight: 500;
      }
      .order-details {
        font-size: 0.8rem;
        color: #666;
      }
      .order-total {
        color: #059669;
        font-weight: 600;
      }
      .status-badge {
        display: inline-block;
        padding: 0.15rem 0.4rem;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 500;
      }
      .status-pending {
        background: #fef3c7;
        color: #92400e;
      }
      .status-processing {
        background: #dbeafe;
        color: #1e40af;
      }
      .status-shipped {
        background: #e0e7ff;
        color: #3730a3;
      }
      .status-completed {
        background: #d1fae5;
        color: #065f46;
      }
      .status-cancelled {
        background: #fee2e2;
        color: #991b1b;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Mini App - Products & Orders</h1>

      <div class="tabs">
        <button class="tab active" data-tab="products">Products</button>
        <button class="tab" data-tab="orders">Orders</button>
      </div>

      <!-- Products Tab -->
      <div id="products-tab" class="tab-content active">
        <form id="product-form">
          <input
            id="product-name"
            type="text"
            placeholder="Product name"
            required
          />
          <div class="form-row">
            <input
              id="product-price"
              type="number"
              step="0.01"
              placeholder="Price"
              required
            />
            <input
              id="product-stock"
              type="number"
              placeholder="Stock"
              value="0"
            />
          </div>
          <div class="form-row">
            <input id="product-category" type="text" placeholder="Category" />
            <button type="submit">Add Product</button>
          </div>
        </form>
        <ul id="products-list"></ul>
      </div>

      <!-- Orders Tab -->
      <div id="orders-tab" class="tab-content">
        <form id="order-form">
          <input
            id="order-customer"
            type="text"
            placeholder="Customer name"
            required
          />
          <div class="form-row">
            <input
              id="order-product-id"
              type="number"
              placeholder="Product ID"
              required
            />
            <input
              id="order-quantity"
              type="number"
              placeholder="Quantity"
              min="1"
              value="1"
              required
            />
          </div>
          <div class="form-row">
            <input
              id="order-price"
              type="number"
              step="0.01"
              placeholder="Price per unit"
              required
            />
            <button type="submit">Create Order</button>
          </div>
        </form>
        <ul id="orders-list"></ul>
      </div>
    </div>

    <script>
      // Tab switching
      document.querySelectorAll(".tab").forEach((tab) => {
        tab.addEventListener("click", () => {
          const targetTab = tab.dataset.tab;
          document
            .querySelectorAll(".tab")
            .forEach((t) => t.classList.remove("active"));
          document
            .querySelectorAll(".tab-content")
            .forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");
          document.getElementById(`${targetTab}-tab`).classList.add("active");

          // Refresh data when switching tabs
          if (targetTab === "products") {
            fetchProducts();
          } else if (targetTab === "orders") {
            fetchOrders();
          }
        });
      });

      // Products API
      const PRODUCTS_API = "/api/products";
      const productsList = document.getElementById("products-list");
      const productForm = document.getElementById("product-form");
      const productName = document.getElementById("product-name");
      const productPrice = document.getElementById("product-price");
      const productStock = document.getElementById("product-stock");
      const productCategory = document.getElementById("product-category");

      async function fetchProducts() {
        try {
          const res = await fetch(PRODUCTS_API);
          const products = await res.json();
          renderProducts(products);
        } catch (error) {
          console.error("Error fetching products:", error);
        }
      }

      function renderProducts(products) {
        productsList.innerHTML = "";
        if (!products.length) {
          const li = document.createElement("li");
          li.className = "empty";
          li.textContent = "No products yet. Add one!";
          productsList.appendChild(li);
          return;
        }

        for (const product of products) {
          const li = document.createElement("li");

          const info = document.createElement("div");
          info.className = "product-info";

          const name = document.createElement("div");
          name.className = "product-name";
          name.textContent = product.name;

          const details = document.createElement("div");
          details.className = "product-details";
          details.innerHTML = `
            <span class="product-price">$${product.price.toFixed(2)}</span> • 
            Stock: ${product.stock} • 
            ${product.category || "Uncategorized"}
          `;

          info.appendChild(name);
          info.appendChild(details);
          li.appendChild(info);

          const btn = document.createElement("button");
          btn.textContent = "Delete";
          btn.className = "delete-btn";
          btn.onclick = async () => {
            try {
              await fetch(`${PRODUCTS_API}/${product.id}`, {
                method: "DELETE",
              });
              fetchProducts();
            } catch (error) {
              console.error("Error deleting product:", error);
            }
          };

          li.appendChild(btn);
          productsList.appendChild(li);
        }
      }

      productForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = productName.value.trim();
        const price = parseFloat(productPrice.value);
        const stock = parseInt(productStock.value) || 0;
        const category = productCategory.value.trim() || undefined;

        if (!name || isNaN(price) || price < 0) {
          alert("Please enter a valid name and price");
          return;
        }

        try {
          await fetch(PRODUCTS_API, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, price, stock, category }),
          });
          productName.value = "";
          productPrice.value = "";
          productStock.value = "0";
          productCategory.value = "";
          fetchProducts();
        } catch (error) {
          console.error("Error adding product:", error);
        }
      });

      // Orders API
      const ORDERS_API = "/api/orders";
      const ordersList = document.getElementById("orders-list");
      const orderForm = document.getElementById("order-form");
      const orderCustomer = document.getElementById("order-customer");
      const orderProductId = document.getElementById("order-product-id");
      const orderQuantity = document.getElementById("order-quantity");
      const orderPrice = document.getElementById("order-price");

      async function fetchOrders() {
        try {
          const res = await fetch(ORDERS_API);
          const orders = await res.json();
          renderOrders(orders);
        } catch (error) {
          console.error("Error fetching orders:", error);
        }
      }

      function renderOrders(orders) {
        ordersList.innerHTML = "";
        if (!orders.length) {
          const li = document.createElement("li");
          li.className = "empty";
          li.textContent = "No orders yet. Create one!";
          ordersList.appendChild(li);
          return;
        }

        for (const order of orders) {
          const li = document.createElement("li");

          const info = document.createElement("div");
          info.className = "order-info";

          const customer = document.createElement("div");
          customer.className = "order-customer";
          customer.textContent = order.customerName;

          const details = document.createElement("div");
          details.className = "order-details";
          const statusClass = `status-${order.status}`;
          details.innerHTML = `
            <span class="order-total">$${order.total.toFixed(2)}</span> • 
            Product ID: ${order.productId} • 
            Qty: ${order.quantity} • 
            <span class="status-badge ${statusClass}">${order.status}</span>
          `;

          info.appendChild(customer);
          info.appendChild(details);
          li.appendChild(info);

          const btn = document.createElement("button");
          btn.textContent = "Delete";
          btn.className = "delete-btn";
          btn.onclick = async () => {
            try {
              await fetch(`${ORDERS_API}/${order.id}`, {
                method: "DELETE",
              });
              fetchOrders();
            } catch (error) {
              console.error("Error deleting order:", error);
            }
          };

          li.appendChild(btn);
          ordersList.appendChild(li);
        }
      }

      orderForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const customerName = orderCustomer.value.trim();
        const productId = parseInt(orderProductId.value);
        const quantity = parseInt(orderQuantity.value);
        const price = parseFloat(orderPrice.value);

        if (
          !customerName ||
          isNaN(productId) ||
          isNaN(quantity) ||
          quantity < 1 ||
          isNaN(price) ||
          price < 0
        ) {
          alert("Please enter valid order details");
          return;
        }

        try {
          await fetch(ORDERS_API, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              customerName,
              productId,
              quantity,
              price,
            }),
          });
          orderCustomer.value = "";
          orderProductId.value = "";
          orderQuantity.value = "1";
          orderPrice.value = "";
          fetchOrders();
        } catch (error) {
          console.error("Error creating order:", error);
        }
      });

      // Initial load
      fetchProducts();
    </script>
  </body>
</html>
